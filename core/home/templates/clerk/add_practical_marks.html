{% extends "Login_Page/login_base_template.html" %}
{% load static %} 
{% block css_block %}
<link rel="stylesheet" href="{% static 'css/student_details.css' %}" />
<script src="{% static 'js/student_result.js' %}"
  data-result = "{{ serialized_result_data }}"
></script>
{% endblock %} 
{% block title %} NCC (National Cadet Corps) {% endblock %} 
{% block start %}

<div class="rectangular-box">
  <form class="form" method="POST" action="/search-result/practical/{{current_page}}/">
    <input
      class="form-control mr-sm-2"
      id="search-students-box"
      type="search"
      name="cbse_no"
      placeholder="Enter Regimental No."
      aria-label="Enter Regimental No."
      required
    />
    {% csrf_token %}
    <button class="ctm-btn" type="submit">Search</button>
  </form>
  <button class="ctm-btn" id='student-clear-filter' onclick="clearButtonClick('/view-update-practical-marks/{{current_page}}/')">Clear <i class="bx bx-message-square-x"></i></button>
</div>
<form class="form m-1" id="bulk-approve-form" hidden>
  {% if perms.home.can_generate_certificate %}
    <button class="btn btn-primary m-2" type="button" onclick="bulk_action('generate', '{{csrf_token}}', 'result', '{{current_page}}')">Generate All Certificate</button>
  {% endif %}
</form>
{% if messages %}
<div class="alert alert-primary alert-dismissible" id="success-alert">
    {% for message in messages %}
        {{message}}
    {% endfor %}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}
<div class="table-container">
  <table class="table table-bordered table2">
    <thead>
      <tr>
        <th scope="col"><center><div>Select All</div><input class="form-check-input checkbox-main" type="checkbox" value="" id="flexCheckDefault" onchange="onMainCheckboxToggle()"></center></th>
        <th scope="col" class="center-heading">Student ID</th>
        <th scope="col" class="center-heading">Name</th>
        <th scope="col" class="center-heading">Paper-I(Drill)</th>
        <th scope="col" class="center-heading">Paper-II(WT)</th>
        <th scope="col" class="center-heading">Paper-III(Misc)</th>
        <th scope="col" class="center-heading">Paper-IV(Spl to Corps)</th>
        <th scope="col" class="center-heading">Bonus Marks</th>
        <th scope="col" class="center-heading">Total</th>
        <th scope="col" class="center-heading">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for student in result_data %}
      <tr>
        <th scope="col"><center><input class="form-check-input {% if student.cert_generated == False %}sub-checkbox{% endif %} sub-checkbox-{{forloop.counter}}" type="checkbox" value="{{ student.student_id }}" name='{{ student.student_id }}' onchange="onSubCheckboxToggle('{{forloop.counter}}', '{{student.student_id}}')" {% if student.cert_generated == True %}disabled{%endif%}></center></th>
        <td>{{ student.student_id }}</td>
        <td>{{ student.student_name }}</td>
        <td>{{ student.p_1_total |floatformat:2 }}</td>
        <td>{{ student.p_2_total |floatformat:2 }}</td>
        <td>{{ student.p_3_total |floatformat:2 }}</td>
        <td>{{ student.p_4_total |floatformat:2 }}</td>
        <td>{{ student.result.Bonus_marks |floatformat:2 }}</td>
        <td>{{ student.result.Final_total |floatformat:2 }}</td>
        <td>
          <button
            class="btn btn-info"
            data-bs-toggle="modal"
            data-bs-target="#staticBackdrop"
            {% comment %} onclick="view_student({{student}}, 'view')" {% endcomment %}
            onclick="openModalOnClick('{{forloop.counter}}', 'view')"
          >
            View
          </button>
          {% if perms.home.change_result and enable_modify == True %}
          <button
            class="btn btn-info"
            data-bs-toggle="modal"
            data-bs-target="#staticBackdrop"
            {% comment %} onclick="view_student({{student}}, 'view')" {% endcomment %}
            onclick="openModalOnClick('{{forloop.counter}}', 'modify')"
          >
            Modify
          </button>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="3">No results to view.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div
  class="modal fade modal-lg"
  id="staticBackdrop"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  tabindex="-1"
  aria-labelledby="staticBackdropLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">
          Student Result
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="container">
          <div class="row flex-lg-nowrap">
            <div class="col">
              <div class="row">
                <div class="card">
                  <div class="card-body">
                    <form
                      class="form"
                      id="result-form"
                      method="POST"
                      action="/update-practical-marks/{{current_page}}/"
                    >
                      {% csrf_token %}
                      <div class="e-profile">
                        <div class="row">
                          <div
                            class="col d-flex flex-column flex-sm-row justify-content-between mb-3"
                          >
                            <div class="text-center text-sm-left mb-2 mb-sm-0">
                              <h4 class="pt-sm-2 pb-1 mb-0 ml-3 text-nowrap" id="modal-student-name">
                                
                              </h4>
                            </div>
                          </div>
                        </div>
                        <div class="tab-content pt-3">
                          <div class="tab-pane active">
                            <form
                              class="form"
                              id="result-form-2"
                              method="POST"
                              action="/update-practical-marks/{{current_page}}/"
                            >
                              {% csrf_token %}
                              <div class="row mt-3 mb-3">
                                <div class="col">
                                  <hr />
                                  <div class="row">
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Regimental No.</label>
                                        <input
                                          class="form-control"
                                          id='modal-cbse-no'
                                          type="text"
                                          name="CBSE_No"
                                          value=""
                                          readonly
                                        />
                                        <input
                                          class="form-control"
                                          id='student-id'
                                          type="text"
                                          name="id"
                                          value=""
                                          readonly
                                          hidden
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Full Name</label>
                                        <input
                                          class="form-control"
                                          id="modal-full-name"
                                          type="text"
                                          name="Name"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                  </div>
                                  </div>
                              </div>

                              <div class="row mt-3 mb-3">
                                <div class="col">
                                  <div class="row">
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Unit</label>
                                        <input
                                          class="form-control"
                                          id="modal-unit"
                                          type="text"
                                          name="Unit"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Rank</label>
                                        <input
                                          class="form-control"
                                          id="modal-rank"
                                          type="text"
                                          name="Rank"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                  </div>
                                  <div class="row mt-3 mb-3">
                                    <div class="col">
                                      <div class="form-group">
                                        <label
                                          >School/College & Class in which
                                          studying</label
                                        >
                                        <textarea
                                          class="form-control"
                                          id="modal-school"
                                          rows="2"
                                          name="School_College_Class"
                                        >
                                        
                                        </textarea>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="row">
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Result</label>
                                        <select class="form-select"
                                          id="modal-fresh-failure"
                                          name="Fresh_Failure"
                                          value=""
                                          aria-label="Default select example"  
                                          >
                                          <option value=true>Pass</option>
                                          <option value=false>Fail</option>
                                        </select>
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Attandance</label>
                                        <input
                                          class="form-control"
                                          id="modal-attandance"
                                          type="text"
                                          name="attandance"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Grade</label>
                                        <input
                                          class="form-control"
                                          id="modal-grade"
                                          type="text"
                                          name="grade"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                  </div>
                                  <hr />
                                </div>
                              </div>

                              <div class="row mt-3 mb-3">
                                <div class="col">
                                <center id='modal-heading'>Paper-I (Drill)</center>
                                <div class="row">
                                    <div class="col">
                                    <div class="form-group">
                                        <label>W</label>
                                        <input
                                        class="form-control"
                                        id="res_p1_w"
                                        type="text"
                                        name="result_p1_w"
                                        value=""
                                        required
                                        />
                                    </div>
                                    </div>
                                    <div class="col">
                                    <div class="form-group">
                                        <label>P (80/26.4)</label>
                                        <input
                                        class="form-control"
                                        id="res_p1_p"
                                        type="text"
                                        name="result_p1_p"
                                        value=""
                                        required
                                        />
                                    </div>
                                    </div>
                                    <div class="col">
                                    <div class="form-group">
                                        <label>T (80/26.4)</label>
                                        <input
                                        class="form-control"
                                        id="res_p1_t"
                                        type="text"
                                        name="result_p1_t"
                                        value=""
                                        required
                                        />
                                    </div>
                                    </div>
                                </div>
                                <hr />
                                </div>
                            </div>

                            <div class="row mt-3 mb-3">
                                <div class="col">
                                <center id='modal-heading'>Paper-II (WT)</center>
                                <div class="row">
                                    <div class="col">
                                    <div class="form-group">
                                        <label>W (30/9.9)</label>
                                        <input
                                        class="form-control"
                                        id="res_p2_w"
                                        type="text"
                                        name="result_p2_w"
                                        value=""
                                        required
                                        />
                                    </div>
                                    </div>
                                    <div class="col">
                                    <div class="form-group">
                                        <label>P (30/9.9)</label>
                                        <input
                                        class="form-control"
                                        id="res_p2_p"
                                        type="text"
                                        name="result_p2_p"
                                        value=""
                                        required
                                        />
                                    </div>
                                    </div>
                                    <div class="col">
                                    <div class="form-group">
                                        <label>T (60/19.8)</label>
                                        <input
                                        class="form-control"
                                        id="res_p2_t"
                                        type="text"
                                        name="result_p2_t"
                                        value=""
                                        required
                                        />
                                    </div>
                                    </div>
                                </div>
                                <hr />
                                </div>
                            </div>

                            <div class="row mt-3 mb-3">
                                <div class="col">
                                <center id='modal-heading'>Paper-III (Misc)</center>
                                <div class="row">
                                    <div class="col">
                                    <div class="form-group">
                                        <label>W (210/69.3)</label>
                                        <input
                                        class="form-control"
                                        id="res_p3_w"
                                        type="text"
                                        name="result_p3_w"
                                        value=""
                                        required
                                        />
                                    </div>
                                    </div>
                                </div>
                                <hr />
                                </div>
                            </div>
                            <div class="row mt-3 mb-3">
                                <div class="col">
                                <center id='modal-heading'>Paper-IV (Spl to Corps)</center>
                                <div class="row">
                                    <div class="col">
                                    <div class="form-group">
                                        <label>W (110/36.3)</label>
                                        <input
                                        class="form-control"
                                        id="res_p4_w"
                                        type="text"
                                        name="result_p4_w"
                                        value=""
                                        required
                                        />
                                    </div>
                                    </div>
                                    <div class="col">
                                    <div class="form-group">
                                        <label>P (40/13.2)</label>
                                        <input
                                        class="form-control"
                                        id="res_p4_p"
                                        type="text"
                                        name="result_p4_p"
                                        value=""
                                        required
                                        />
                                    </div>
                                    </div>
                                    <div class="col">
                                    <div class="form-group">
                                        <label>T (150/49.5)</label>
                                        <input
                                        class="form-control"
                                        id="res_p4_t"
                                        type="text"
                                        name="result_p4_t"
                                        value=""
                                        required
                                        />
                                    </div>
                                    </div>
                                </div>
                                <hr />
                                </div>
                            </div>
                              <div class="row mt-3 mb-3">
                                <div class="row mt-3 mb-3">
                                  <div class="col">
                                  <div class="row">
                                      <div class="col">
                                      <div class="form-group">
                                          <label>Bonus Marks Category</label>
                                          <select class="form-select"
                                          id="bonus_marks_cat"
                                          type="text"
                                          name="bonus_marks_cat"
                                          value=""
                                          aria-label="Default select example"  
                                          onclick="calculateTotalMarks('{{bonus_marks_ser}}')"
                                          >
                                          {% for item in bonus_marks %}
                                              <option value={{item.id}} percentage={{item.percentage}}>{{item.type}}</option>
                                          {% endfor %}
                                          </select>
                                      </div>
                                      </div>
                                      <div class="col">
                                      <div class="form-group">
                                          <label>Bonus Marks</label>
                                          <input
                                          class="form-control"
                                          id="modal-bonus-marks"
                                          type="text"
                                          name="bonus_marks"
                                          value=""
                                          readonly
                                          />
                                      </div>
                                      </div>
                                      <div class="col">
                                      <div class="form-group">
                                          <label>Total Marks</label>
                                          <input
                                          class="form-control"
                                          id="form-total-marks"
                                          type="text"
                                          name="modal_total"
                                          value=""
                                          readonly
                                          />
                                      </div>
                                      </div>
                                  </div>
                                  </div>
                              </div>
                              </div>
                            </form>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close
        </button>
        {% if perms.home.change_result %}
          <button type="button" id="student-submit-button" class="btn btn-primary" data-bs-dismiss="modal" onclick='formSubmit()'>
            Modify
          </button>
        {% endif %}
      </div>
    </div>
  </div>
</div>
</div>
<center>
  <nav aria-label="Page navigation example">
    <ul class="pagination">
      <li class="page-item {% if disable_prev %}disabled{% endif %}">
        <a class="page-link" href="/view-update-practical-marks/{{prev_page}}/" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
      {% for i in page_range %}
        <li class="page-item {% if i == current_page %}active{% endif %}"><a class="page-link" href="/view-update-practical-marks/{{i}}/">{{i}}</a></li>
      {% endfor %}
      <li class="page-item {% if disable_next%}disabled{% endif %}">
        <a class="page-link" href="/view-update-practical-marks/{{next_page}}/" aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    </ul>
  </nav>
</center>
{% if student %} {% endif %} {% endblock %}
