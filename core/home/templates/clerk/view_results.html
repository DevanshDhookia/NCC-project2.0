{% extends "Login_Page/login_base_template.html" %}
{% load static %} 
{% block css_block %}
<link rel="stylesheet" href="{% static 'css/student_details.css' %}" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="{% static 'js/student_result.js' %}"
  data-result = "{{ serialized_result_data }}"
></script>
{% endblock %} 
{% block title %} NCC (National Cadet Corps) {% endblock %} 
{% block start %}
<div></div>
<div class="rectangular-box">
  <form class="form" method="GET" action="{% url 'search_student' %}">
    <input
      class="form-control mr-sm-2"
      id="search-students-box"
      type="search"
      name="cbse_no"
      placeholder="Enter CBSE No."
      aria-label="Enter CBSE No."
      required
    />
    <button class="ctm-btn" type="submit">Search</button>
  </form>
  <button class="ctm-btn" id='student-clear-filter' onclick='clearButtonClick()'>Clear <i class="bx bx-message-square-x"></i></button>
</div>
<div class="table-container">
  <table class="table table-bordered table2">
    <thead>
      <tr>
        <th scope="col">Sr.No.</th>
        <th scope="col">Student ID</th>
        <th scope="col">Name</th>
        <th scope="col">Paper-I(Drill)</th>
        <th scope="col">Paper-II(WT)</th>
        <th scope="col">Paper-III(Misc)</th>
        <th scope="col">Paper-IV(Spl to Corps)</th>
        <th scope="col">Bonus Marks</th>
        <th scope="col">Total</th>
        <th scope="col">Result</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for student in result_data %}
      <tr>
        <th scope="row">{{ forloop.counter }}</th>
        <td>{{ student.student_id }}</td>
        <td>{{ student.student_name }}</td>
        <td>{{ student.p_1_total |floatformat:2 }}</td>
        <td>{{ student.p_2_total |floatformat:2 }}</td>
        <td>{{ student.p_3_total |floatformat:2 }}</td>
        <td>{{ student.p_4_total |floatformat:2 }}</td>
        <td>{{ student.result.Bonus_marks |floatformat:2 }}</td>
        <td>{{ student.result.Final_total |floatformat:2 }}</td>
        <td>{{ student.result.Pass_Fail }}</td>
        <td>
          <button
            class="btn btn-info"
            data-bs-toggle="modal"
            data-bs-target="#staticBackdrop"
            {% comment %} onclick="view_student({{student}}, 'view')" {% endcomment %}
            onclick="openModalOnClick('{{forloop.counter}}', 'view')"
          >
            View
          </button>
          {% if perms.home.can_edit_student_details %}
            <button class="btn btn-primary"
              data-bs-toggle="modal"
              data-bs-target="#staticBackdrop"
              onclick="openModalOnClick('{{forloop.counter}}', 'modify')"
            >Modify</button>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="3">No studnets are registered .</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div
  class="modal fade modal-lg"
  id="staticBackdrop"
  data-bs-backdrop="static"
  data-bs-keyboard="false"
  tabindex="-1"
  aria-labelledby="staticBackdropLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">
          Student Result
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="container">
          <div class="row flex-lg-nowrap">
            <div class="col">
              <div class="row">
                <div class="card">
                  <div class="card-body">
                    <form
                      class="form"
                      id="result-form"
                      method="POST"
                      action="{% url 'update-results' %}"
                    >
                      {% csrf_token %}
                      <div class="e-profile">
                        <div class="row">
                          <div
                            class="col d-flex flex-column flex-sm-row justify-content-between mb-3"
                          >
                            <div class="text-center text-sm-left mb-2 mb-sm-0">
                              <h4 class="pt-sm-2 pb-1 mb-0 ml-3 text-nowrap" id="modal-student-name">
                                
                              </h4>
                            </div>
                          </div>
                        </div>
                        <div class="tab-content pt-3">
                          <div class="tab-pane active">
                            <form
                              class="form"
                              id="result-form-2"
                              method="POST"
                              action="{% url 'update-results' %}"
                            >
                              {% csrf_token %}
                              <div class="row mt-3 mb-3">
                                <div class="col">
                                  <hr />
                                  <div class="row">
                                    <div class="col">
                                      <div class="form-group">
                                        <label>CBSE No.</label>
                                        <input
                                          class="form-control"
                                          id='modal-cbse-no'
                                          type="text"
                                          name="CBSE_No"
                                          value=""
                                          readonly
                                        />
                                        <input
                                          class="form-control"
                                          id='student-id'
                                          type="text"
                                          name="id"
                                          value=""
                                          readonly
                                          hidden
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Full Name</label>
                                        <input
                                          class="form-control"
                                          id="modal-full-name"
                                          type="text"
                                          name="Name"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                  </div>
                                  </div>
                              </div>

                              <div class="row mt-3 mb-3">
                                <div class="col">
                                  <div class="row">
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Unit</label>
                                        <input
                                          class="form-control"
                                          id="modal-unit"
                                          type="text"
                                          name="Unit"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Rank</label>
                                        <input
                                          class="form-control"
                                          id="modal-rank"
                                          type="text"
                                          name="Rank"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                  </div>
                                  <div class="row mt-3 mb-3">
                                    <div class="col">
                                      <div class="form-group">
                                        <label
                                          >School/College & Class in which
                                          studying</label
                                        >
                                        <textarea
                                          class="form-control"
                                          id="modal-school"
                                          rows="2"
                                          name="School_College_Class"
                                        >
                                        
                                        </textarea>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="row">
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Result</label>
                                        <input
                                          class="form-control"
                                          id="modal-fresh-failure"
                                          type="text"
                                          name="Fresh_Failure"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Attandance</label>
                                        <input
                                          class="form-control"
                                          id="modal-attandance"
                                          type="text"
                                          name="attandance"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Grade</label>
                                        <input
                                          class="form-control"
                                          id="modal-grade"
                                          type="text"
                                          name="grade"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                  </div>
                                  <hr />
                                </div>
                              </div>

                              <div class="row mt-3 mb-3">
                                <div class="col">
                                  <center id='modal-heading'>Paper-I (Drill)</center>
                                  <div class="row">
                                    <div class="col">
                                      <div class="form-group">
                                        <label>W</label>
                                        <input
                                          class="form-control"
                                          id="res_p1_w"
                                          type="text"
                                          name="result_p1_w"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>P (50/16.5)</label>
                                        <input
                                          class="form-control"
                                          id="res_p1_p"
                                          type="text"
                                          name="result_p1_p"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>T (50/16.5)</label>
                                        <input
                                          class="form-control"
                                          id="res_p1_t"
                                          type="text"
                                          name="result_p1_t"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                  </div>
                                  <hr />
                                </div>
                              </div>

                              <div class="row mt-3 mb-3">
                                <div class="col">
                                  <center id='modal-heading'>Paper-II (WT)</center>
                                  <div class="row">
                                    <div class="col">
                                      <div class="form-group">
                                        <label>W (10/3.3)</label>
                                        <input
                                          class="form-control"
                                          id="res_p2_w"
                                          type="text"
                                          name="result_p2_w"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>P (60/19.8)</label>
                                        <input
                                          class="form-control"
                                          id="res_p2_p"
                                          type="text"
                                          name="result_p2_p"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>T (70/23.1)</label>
                                        <input
                                          class="form-control"
                                          id="res_p2_t"
                                          type="text"
                                          name="result_p2_t"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                  </div>
                                  <hr />
                                </div>
                              </div>

                              <div class="row mt-3 mb-3">
                                <div class="col">
                                  <center id='modal-heading'>Paper-III (Misc)</center>
                                  <div class="row">
                                    <div class="col">
                                      <div class="form-group">
                                        <label>W (230/75.9)</label>
                                        <input
                                          class="form-control"
                                          id="res_p3_w"
                                          type="text"
                                          name="result_p3_w"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                  </div>
                                  <hr />
                                </div>
                              </div>
                              <div class="row mt-3 mb-3">
                                <div class="col">
                                  <center id='modal-heading'>Paper-IV (Spl to Corps)</center>
                                  <div class="row">
                                    <div class="col">
                                      <div class="form-group">
                                        <label>W (110/36.3)</label>
                                        <input
                                          class="form-control"
                                          id="res_p4_w"
                                          type="text"
                                          name="result_p4_w"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>P (40/13.2)</label>
                                        <input
                                          class="form-control"
                                          id="res_p4_p"
                                          type="text"
                                          name="result_p4_p"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>T (150/49.5)</label>
                                        <input
                                          class="form-control"
                                          id="res_p4_t"
                                          type="text"
                                          name="result_p4_t"
                                          value=""
                                        />
                                      </div>
                                    </div>
                                  </div>
                                  <hr />
                                </div>
                              </div>
                              <div class="row mt-3 mb-3">
                                <div class="col">
                                  <div class="row">
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Bonus Marks Category</label>
                                        <select class="form-select"
                                          id="bonus_marks_cat"
                                          type="text"
                                          name="bonus_marks_cat"
                                          value=""
                                          aria-label="Default select example"  
                                          onclick="calculateTotalMarks('{{bonus_marks_ser}}')"
                                        >
                                          {% for item in bonus_marks %}
                                            <option value={{item.id}} percentage={{item.percentage}}>{{item.type}}</option>
                                          {% endfor %}
                                        </select>
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Bonus Marks</label>
                                        <input
                                          class="form-control"
                                          id="modal-bonus-marks"
                                          type="text"
                                          name="bonus_marks"
                                          value=""
                                          readonly
                                        />
                                      </div>
                                    </div>
                                    <div class="col">
                                      <div class="form-group">
                                        <label>Total Marks</label>
                                        <input
                                          class="form-control"
                                          id="form-total-marks"
                                          type="text"
                                          name="modal_total"
                                          value=""
                                          readonly
                                        />
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </form>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close
        </button>
        <button type="button" class="btn btn-info" id="student-approval-button" data-bs-dismiss="modal">
          Send for Approval
        </button>
        <button type="button" id="student-submit-button" class="btn btn-primary" data-bs-dismiss="modal" onclick='formSubmit()'>
          Modify
        </button>
      </div>
    </div>
  </div>
</div>

{% if student %} {% endif %} {% endblock %}
